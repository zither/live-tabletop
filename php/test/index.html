<html>
	<head>
		<title>Live Tabletop Automated Test</title>
		<link rel="stylesheet" href="test.css"/>
		<script type="text/javascript" src="../../jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="../../js/LT.js"></script>
		<script type="text/javascript" src="../../js/uploader.js"></script>
		<script type="text/javascript" src="test.js"></script>
		<script type="text/javascript">

// constants
TEST.USER = {login: "foo", password: "bar"};
TEST.TABLE_ARGS = {
	'name': "My Table",
	image_id: 1,
	default_tile: 2,
	rows: 100,
	columns: 50,
	tile_width: 45,
	tile_height: 30,
	tile_mode: "rectangle",
	grid_thickness: 1,
	grid_color: "gray",
	wall_thickness: 3,
	wall_color: "black",
};
TEST.ADMIN = {login: "nymduh", password: "draosup"};
TEST.ADMIN2 = {login: "admin2", password: "password2"};
TEST.INSTALL_ARGS = {
	admin_login: TEST.ADMIN.login,
	admin_password: TEST.ADMIN.password,
};

// list of tests
TEST.tests = [

	// INSTALL
	{group: "INSTALL",
		action: "../install.php",
		abort: true,
		args: TEST.INSTALL_ARGS,
		result: TEST.blank},
	{action: "../db_config.php", args: {}, result: TEST.exists},

	// clear session variables
	{action: "../Admin.logout.php", args: {}, result: TEST.exists},
	{action: "../User.logout.php", args: {}, result: TEST.exists},

	// ADMIN

	{group: "ADMIN.CREATE", action: "../Admin.create.php", args: TEST.ADMIN2, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.create.php", args: TEST.ADMIN2, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.LOGIN", action: "../Admin.login.php", args: {login: "admin2", password: "wrong"}, result: TEST.unauthorized},
	{action: "../Admin.login.php", args: {login: "wrong", password: "password2"}, result: TEST.unauthorized},
	{action: "../Admin.login.php", args: TEST.ADMIN2, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.LOGOUT", action: "../Admin.logout.php", args: {}, result: TEST.blank},
	{action: "../Admin.create.php", args: TEST.ADMIN2, result: TEST.logged_out},

	{group: "ADMIN.DELETE", action: "../Admin.delete.php", args: {login: "admin2"}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.delete.php", args: {login: "admin2"}, result: TEST.blank},
	{action: "../Admin.login.php", args: TEST.ADMIN2, result: TEST.unauthorized},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.PASSWORD", action: "../Admin.password.php", args: {password: "newPassword"}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.password.php", args: {password: "newPassword"}, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},
	{action: "../Admin.login.php", args: {login: TEST.ADMIN.login, password: "newPassword"}, result: TEST.blank},
	{action: "../Admin.password.php", args: {password: TEST.ADMIN.password}, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.USERS", action: "../Admin.users.php", args: {}, result: TEST.logged_out},
	{action: "../User.create.php", args: {login: "larry", password: "curly", email: "a@b.c", subscribed: 1}, result: TEST.blank},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.users.php", args: {}, result: TEST.one},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.FRIENDS", action: "../Admin.friends.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.friends.php", args: {user: 1}, result: TEST.zero},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.USER PASSWORD", action: "../Admin.userPassword.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.userPassword.php", args: {user: 1, password: "shemp"}, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},
	{action: "../User.login.php", args: {login: "larry", password: "shemp"}, result: TEST.exists},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.CAMPAIGNS", action: "../Admin.campaigns.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: {login: "larry", password: "shemp"}, result: TEST.exists},
	{action: "../Campaign.create.php", args: {name: "My Campaign"}, result: TEST.exists},
	{action: "../User.logout.php", args: {}, result: TEST.blank},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.campaigns.php", args: {}, result: TEST.one},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.MESSAGES", action: "../Admin.messages.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.messages.php", args: {campaign: 1}, result: TEST.zero},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.EXPIRE MESSAGES", action: "../Admin.expireMessages.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.expireMessages.php", args: {}, result: TEST.blank},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.DELETE CAMPAIGN", action: "../Admin.deleteCampaign.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.deleteCampaign.php", args: {campaign: 1}, result: TEST.blank},
	{action: "../Admin.campaigns.php", args: {}, result: TEST.zero},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	{group: "ADMIN.DELETE USER", action: "../Admin.deleteUser.php", args: {}, result: TEST.logged_out},
	{action: "../Admin.login.php", args: TEST.ADMIN, result: TEST.blank},
	{action: "../Admin.deleteUser.php", args: {user: 1}, result: TEST.blank},
	{action: "../Admin.users.php", args: {}, result: TEST.zero},
	{action: "../Admin.logout.php", args: {}, result: TEST.blank},

	// U S E R

	{group: "USER.CREATE", action: "../User.create.php",
		args: {login: TEST.USER.login, password: TEST.USER.password, email: "x@y.z", subscribed: 0}, result: TEST.blank},

	{group: "USER.LOGIN", action: "../User.login.php", args: {login: TEST.USER.login, password: "wrong"}, result: TEST.unauthorized},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.campaigns.php", args: {}, result: TEST.exists},

	{group: "USER.LOGOUT", action: "../User.logout.php", args: {}, result: TEST.blank},
	{action: "../User.campaigns.php", args: {}, result: TEST.logged_out},

	{group: "USER.CHARACTERS", action: "../User.characters.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.characters.php", args: {}, result: TEST.zero},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.CAMPAIGNS", action: "../User.campaigns.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.campaigns.php", args: {}, result: TEST.zero},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.MAPS", action: "../User.maps.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.maps.php", args: {}, result: TEST.zero},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.UPDATE", action: "../User.update.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{group: "USER.UPDATE", action: "../User.update.php", args: {name: "moe", color: "green", email: "a@b.c", subscribed: 1}, result: TEST.blank},
	{action: "../User.logout.php", args: {}, result: TEST.blank},
	{action: "../User.login.php", args: TEST.USER, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.name == "moe" && data.color == "green" && data.email == "a@b.c" && data.subscribed == 1) return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER PASSWORD", action: "../User.password.php", args: {password: "newPassword"}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.password.php", args: {password: "newPassword"}, result: TEST.blank},
	{action: "../User.logout.php", args: {}, result: TEST.blank},
	{action: "../User.login.php", args: {login: TEST.USER.login, password: "newPassword"}, result: TEST.exists},
	{action: "../User.password.php", args: {password: TEST.USER.password}, result: TEST.blank},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.FRIENDS", action: "../User.friends.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.friends.php", args: {}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.requested.length + data.recieved.length + data.confirmed.length == 0) return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.FRIEND", action: "../User.friend.php", args: {}, result: TEST.logged_out},
	{action: "../User.create.php", args: {login: "toad", password: "hall", email: "a@b.c", subscribed: 1}, result: TEST.blank},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.friend.php", args: {recipient: 2}, result: TEST.blank}, // friending self should fail silently
	{action: "../User.friend.php", args: {recipient: 3}, result: TEST.blank},
	{action: "../User.friends.php", args: {}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.requested.length + data.recieved.length + data.confirmed.length == 1) return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "USER.UNFRIEND", action: "../User.unfriend.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../User.unfriend.php", args: {recipient: 3}, result: TEST.blank},
	{action: "../User.friends.php", args: {}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.requested.length + data.recieved.length + data.confirmed.length == 0) return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

/*
	{group: "DELETE USER",
		action: "../delete_user.php",
		args: {user_id: 2},
		result: TEST.blank},
	{action: "../read_users.php", args: {}, result: TEST.one},
*/

	// C A M P A I G N

	{group: "CAMPAIGN.CREATE", action: "../Campaign.create.php", args: {name: "My Campaign"}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.create.php", args: {name: "My Campaign"}, result: function (ajax) {return TEST.json(ajax, {id: 2});}},
	{action: "../User.campaigns.php", args: {}, result: TEST.one},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.NAME", action: "../Campaign.name.php", args: {campaign: 2, name: "Still My Campaign"}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.name.php", args: {campaign: 2, name: "Still My Campaign"}, result: TEST.blank},
	{action: "../User.campaigns.php", args: {}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data[0].campaign_id == 2 && data[0].name == "Still My Campaign") return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.PRIVATE", action: "../Campaign.private.php", args: {campaign: 2, 'private': 0}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.private.php", args: {campaign: 2, 'private': 0}, result: TEST.blank},
	{action: "../Campaign.read.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data['private'] == 0) return "PASS"; else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../Campaign.private.php", args: {campaign: 2, 'private': 1}, result: TEST.blank},
	{action: "../Campaign.read.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data['private'] == 1) return "PASS"; else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.READ", action: "../Campaign.read.php", args: {campaign: 2}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.read.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.id == 2 && data.name == "Still My Campaign" && data['private'] === true && data.map === null
			&& JSON.stringify(data.turns) == "[]" && typeof(data.last_message) == "number"
			&& typeof(data.users_modified) == 'number') return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.MAP", action: "../Campaign.map.php", args: {campaign: 2, map: 1}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.map.php", args: {campaign: 2, map: 1}, result: TEST.blank},
	{action: "../Campaign.read.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data.map == 1) return "PASS"; else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.TURNS", action: "../Campaign.turns.php", args: {campaign: 2, turns: "[1,1,2,3,5,8,13,21]"}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.turns.php", args: {campaign: 2, turns: "[1,1,2,3,5,8,13,21]"}, result: TEST.blank},
	{action: "../Campaign.read.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (JSON.stringify(data.turns) == "[1,1,2,3,5,8,13,21]") return "PASS"; else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.USERS", action: "../Campaign.users.php", args: {campaign: 2}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.users.php", args: {campaign: 2}, result: function (ajax) {
		try {var data = JSON.parse(ajax.responseText);} catch (e) {return "FAIL [parse error: " + e + "]";}
		if (data[0].user_id == 3 && data[0].permission == "owner" && data[0].viewing === false && data[0].avatar === null
			&& data[0].login == TEST.USER.login && data[0].name === null) return "PASS";
		else return "FAIL [" + ajax.responseText + "]";}},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.ARRIVE", action: "../Campaign.arrive.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.arrive.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.MESSAGE", action: "../Campaign.message.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.message.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.MESSAGES", action: "../Campaign.messages.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.messages.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.AVATAR", action: "../Campaign.avatar.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.avatar.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.LEAVE", action: "../Campaign.leave.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.leave.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},

	{group: "CAMPAIGN.PERMISSION", action: "../Campaign.permission.php", args: {}, result: TEST.logged_out},
	{action: "../User.login.php", args: TEST.USER, result: TEST.exists},
	{action: "../Campaign.permission.php", args: {}, result: TEST.unimplemented},
	{action: "../User.logout.php", args: {}, result: TEST.blank},


	{group: "PRIVATE ROLL",
		action: "../private_roll.php",
		args: {text: "From 1975 - 2010, [0 + 2010 - 1975] years passed."},
		result: function (ajax) {
			try {var data = JSON.parse(ajax.responseText);}
			catch (e) {return "FAIL [parse error: " + e + "]";}
			if (data[0].message == 'From 1975 - 2010, <span class="roll">0 + 2010 - '
				+ '1975 = 35</span> years passed.') return "PASS";
			else return "FAIL [" + ajax.responseText + "]";}},

	{group: "CREATE MESSAGE",
		action: "../create_message.php",
		args: {table_id: 1, user_id: 1, text: "Hello, world!"},
		result: TEST.blank},

	{group: "READ MESSAGES",
		action: "../read_messages.php",
		args: {table_id: 1, last_message: 0},
		result: TEST.one},


	// M A P

	{group: "MAP.CREATE", action: "../Map.create.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.READ", action: "../Map.read.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.PIECES", action: "../Map.pieces.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.SETTINGS", action: "../Map.settings.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.SIZE", action: "../Map.size.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.TILE", action: "../Map.tile.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.CHANGES", action: "../Map.changes.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.SHARE", action: "../Map.share.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.OWNERS", action: "../Map.owners.php", args: {}, result: TEST.unimplemented},
	{group: "MAP.DELETE OWNER", action: "../Map.deleteOwner.php", args: {}, result: TEST.unimplemented},

	{group: "CREATE TABLE",
		action: "../create_table.php",
		args: {
			name: "My Other Table",
			image_id: 5,
			default_tile: 7,
			rows: 16,
			columns: 25,
			tile_width: 32,
			tile_height: 40,
			grid_thickness: 7,
			grid_color: "red",
			wall_thickness: 3,
			wall_color: "green",
			tile_mode: "rectangle",
		},
		result: TEST.one},

	{group: "READ TABLE",
		action: "../read_table.php",
		args: {table_id: 2},
		result: TEST.one},

	{group: "READ TABLES",
		action: "../read_tables.php",
		args: {},
		result: function (ajax) {return TEST.count(ajax, 2);}},

	{group: "UPDATE TABLE",
		action: "../update_table.php",
		args: {
			table_id: 1,
			name: "My Original Table",
			image_id: 3,
			tile_width: 30,
			tile_height: 20,
			grid_thickness: 2,
			grid_color: "brown",
			wall_thickness: 1,
			wall_color: "blue",
			tile_mode: 'isometric',
		},
		result: TEST.blank},
	{action: "../read_table.php",
		args: {table_id: 1},
		result: function (ajax) {
			try {var data = JSON.parse(ajax.responseText);}
			catch (e) {return "FAIL [parse error: " + e + "]";}
			for (var i = 0; i < data.length; i++)
				if (data[i].id == 1 && data[i].name == "My Original Table") return "PASS";
			return "FAIL [" + ajax.responseText + "]";}},

	{group: "DELETE TABLE",
		action: "../delete_table.php",
		args: {table_id: 2},
		result: TEST.blank},
	{action: "../read_tables.php", args: {}, result: TEST.one},

	// T I L E

	{group: "READ TILES",
		action: "../read_tiles.php",
		args: {table_id: 1},
		result: function (ajax) {
			var text = ajax.responseXML.documentElement.textContent;
			var tiles = text.replace(/^\s+|\s+$/g, '').split(' ');
			if (tiles.length != 5000) return "FAIL [" + tiles.length + " tiles]";
			for (var i = 0; i < tiles.length; i++)
				 if (tiles[i] != "02") return "FAIL [" + i + ": " + tiles[i] + "]";
			return "PASS";}},

	{group: "UPDATE TILE",
		action: "../update_tile.php",
		args: {
			table_id: 1,
			x: 7,
			y: 10,
			image_id: 4,
			fog: 1,
			right: 2,
			bottom: 1},
		result: TEST.blank},
	{action: "../read_tiles.php",
		args: {table_id: 1},
		result: function (ajax) {
			var text = ajax.responseXML.documentElement.textContent;
			var tiles = text.replace(/^\s+|\s+$/g, '').split(' ');
			if (tiles.length != 5000) return "FAIL [" + tiles.length + " tiles]";
			for (var i = 0; i < tiles.length; i++) {
				 var target = (i == 507) ? "14" : "02";
				 if (tiles[i] != target) return "FAIL [" + i + ": " + tiles[i] + "]";
			}
			return "PASS";}},

	{group: "FILL FOG",
		action: "../fill_fog.php", args: {table_id: 1}, result: TEST.blank},
	{action: "../read_tiles.php",
		args: {table_id: 1},
		result: function (ajax) {
			var text = ajax.responseXML.documentElement.textContent;
			var tiles = text.replace(/^\s+|\s+$/g, '').split(' ');
			if (tiles.length != 5000) return "FAIL [" + tiles.length + " tiles]";
			for (var i = 0; i < tiles.length; i++) {
				 var target = (i == 507) ? "14" : "12";
				 if (tiles[i] != target) return "FAIL [" + i + ": " + tiles[i] + "]";
			}
			return "PASS";}},

	{group: "CLEAR FOG",
		action: "../clear_fog.php", args: {table_id: 1}, result: TEST.blank},
	{action: "../read_tiles.php",
		args: {table_id: 1},
		result: function (ajax) {
			var text = ajax.responseXML.documentElement.textContent;
			var tiles = text.replace(/^\s+|\s+$/g, '').split(' ');
			if (tiles.length != 5000) return "FAIL [" + tiles.length + " tiles]";
			for (var i = 0; i < tiles.length; i++) {
				 var target = (i == 507) ? "04" : "02";
				 if (tiles[i] != target) return "FAIL [" + i + ": " + tiles[i] + "]";
			}
			return "PASS";}},

	// WALL

	{group: "CREATE WALL",
		action: "../create_wall.php",
		args: {table_id: 1, x: 2, y: 3, direction: "sw", contents: "wall"},
		result: TEST.blank},

	{group: "READ WALLS",
		action: "../read_walls.php",
		args: {table_id: 1},
		result: function (ajax) {
			var wall = ajax.responseXML.getElementsByTagName("wall")[0];
			if (wall.getAttribute("x") == "2"
				&& wall.getAttribute("y") == "3"
				&& wall.getAttribute("direction") == "sw"
				&& wall.getAttribute("contents") == "wall"
				) return "PASS";
			return "FAIL [" + ajax.responseText + "]";}},

	{group: "DELETE WALL",
		action: "../delete_wall.php",
		args: {table_id: 1, x: 2, y: 3, direction: "sw"},
		result: TEST.blank},
	{action: "../read_walls.php", args: {table_id: 1}, result: TEST.zero},

	// P I E C E

	{group: "PIECE.CREATE", action: "../Piece.create.php", args: {}, result: TEST.unimplemented},
	{group: "PIECE.MOVE", action: "../Piece.move.php", args: {}, result: TEST.unimplemented},
	{group: "PIECE.SETTINGS", action: "../Piece.settings.php", args: {}, result: TEST.unimplemented},
	{group: "PIECE.DELETE", action: "../Piece.delete.php", args: {}, result: TEST.unimplemented},

	{group: "CREATE PIECE",
		action: "../create_piece.php",
		args: {
			table_id: 1,
			image_id: 10,
			user_id: 1,
			name: "My Piece",
			x: 30,
			y: 100,
			x_offset: -32,
			y_offset: -8,
			height: 16,
			width: 64},
		result: TEST.blank},

	{group: "READ PIECES",
		action: "../read_pieces.php",
		args: {table_id: 1},
		result: TEST.one},

	{group: "UPDATE PIECE",
		action: "../update_piece.php",
		args: {
			piece_id: 1,
			image_id: 11,
			user_id: 2,
			name: "Still My Piece",
			x: 99,
			y: 49,
			x_offset: 5,
			y_offset: 10,
			width: 20,
			height: 40,
			color: "orange"},
		result: TEST.blank},
	{action: "../read_pieces.php",
		args: {table_id: 1},
		result: function (ajax) {
			try {var data = JSON.parse(ajax.responseText);}
			catch (e) {return "FAIL [parse error: " + e + "]";}
			for (var i = 0; i < data.length; i++)
				if (data[i].id == 1
					&& data[i].image_id == 11
					&& data[i].user_id == 2
					&& data[i].name == "Still My Piece"
					&& data[i].x == 99
					&& data[i].y == 49
					&& data[i].x_offset == 5
					&& data[i].y_offset == 10
					&& data[i].width == 20
					&& data[i].height == 40
					&& data[i].color == "orange"
				) return "PASS";
			return "FAIL [" + ajax.responseText + "]";}},

	{group: "DELETE PIECE",
		action: "../delete_piece.php", args: {piece_id: 1}, result: TEST.blank},
	{action: "../read_pieces.php",
		args: {table_id: 1},
		result: TEST.zero},

	// C H A R A C T E R

	{group: "CHARACTER.CREATE", action: "../Character.create.php", args: {}, result: TEST.unimplemented},
	{group: "CHARACTER.SHARE", action: "../Character.share.php", args: {}, result: TEST.unimplemented},
	{group: "CHARACTER.OWNERS", action: "../Character.owners.php", args: {}, result: TEST.unimplemented},
	{group: "CHARACTER.DELETE OWNER", action: "../Character.deleteOwner.php", args: {}, result: TEST.unimplemented},

	{group: "UPDATE STAT",
		action: "../update_stat.php",
		args: {piece_id: 1, name: "hit points", value: "20"},
		result: TEST.blank},
	{action: "../read_pieces.php",
		args: {table_id: 1},
		result: function (ajax) {
			var stats = ajax.responseXML.getElementsByTagName("stat");
			for (var i = 0; i < stats.length; i++) {
				if (decodeURIComponent(stats[i].getAttribute("name")) == "hit points"
					&& decodeURIComponent(stats[i].textContent) == "20") return "PASS";
			}
			return "FAIL [" + ajax.responseText + "]";}},

	{group: "DELETE STAT",
		action: "../delete_stat.php",
		args: {piece_id: 1, name: "hit points"},
		result: TEST.blank},
	{action: "../read_pieces.php",
		args: {table_id: 1},
		result: TEST.zero},

];

onload = function () {
	$.get("test.json", function (data) {
		$("input[name='location']").val(data.location);
		$("input[name='database']").val(data.database);
		$("input[name='username']").val(data.username);
		$("input[name='password']").val(data.password);
	});
	$("input[name='begin']").click(function () {
		TEST.INSTALL_ARGS.location = $("input[name='location']").val();
		TEST.INSTALL_ARGS.database = $("input[name='database']").val();
		TEST.INSTALL_ARGS.username = $("input[name='username']").val();
		TEST.INSTALL_ARGS.password = $("input[name='password']").val();
		TEST.start();
	});
}
		</script>
	</head>
	<body>
		<div><input type="text" name="location"/>URL of database server</div>
		<div><input type="text" name="database"/>database name</div>
		<div><input type="text" name="username"/>database user name</div>
		<div><input type="password" name="password"/>database password</div>
		<div><input type="button" name="begin" value="Begin Test"/></div>
		<div id="output"></div>
	</body>
</html>
